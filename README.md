# MIL-SI
Pancreatic Cancer ROSE Image Classification Based on Multiple Instance Learning with Shuffle Instances

* Results can be view in Archive folder 

* Colab scripts are provided with a sample dataset (MICCAI 2015 chanllange)

# Abstract

The rapid on-site evaluation (ROSE) technique can significantly accelerate the diagnostic workflow of pancreatic cancer by immediately analyzing the fast-stained cytopathological images with on-site pathologists. Computer-aided diagnosis (CAD) using the deep learning method has the potential to solve the problem of insufficient pathology staffing. However, the cancerous patterns of ROSE images vary greatly between different samples, making the CAD task extremely challenging. Besides, due to different staining qualities and various types of acquisition devices, the ROSE images also have complicated perturbations in terms of color distribution, brightness, and contrast. To address these challenges, we proposed a novel multiple instance learning (MIL) approach using shuffle patches as the instances, which adopts the patch-based learning strategy of Vision Transformers. With the shuffle instances of grouped cell patches and their bag-level soft labels, the approach utilizes a MIL head to make the model focus on the features from the pancreatic cancer cells, rather than that from various perturbations in ROSE images. Simultaneously, combined with a classification head, the model can effectively identify the general distributive patterns across different instances. The results demonstrate the significant improvements in the classification accuracy with more accurate attention regions, indicating that the diverse patterns of ROSE images are effectively extracted and the complicated perturbations of ROSE images are greatly eliminated. It also suggests that the MIL with shuffle instances has great potential in the analysis of cytopathological images.


# Method Overview

![MIL-SI](https://user-images.githubusercontent.com/50575108/154795968-9018d2c2-6770-4ddd-9fef-6da0aba9b54e.png)

Overview of our proposed approach MIL-SI, composed of two steps MIL step and CLS step. In the data processing as illustrated in (a), the images will be transformed into patch-es, and the patch annotation label will be calculated based on the corresponding masks. In the MIL step, the bags of patches within a batch will be shuffled while the bags of image patches will remain unchanged in the CLS step. The bags are then composed into images with the soft-label aggregated from the patch-level label. In the 2-step training process in (b), after the feature extraction of the backbone, the patch tokens will be used to regress the bag-level soft-label in the MIL head. In the CLS step, an additional CLS head will be used to predict the categories of the input images based on the class token.

# Results and CAM

# MIL-SI

|                                     |            |                 |          |          |             |            | Train     | Train              | Train           | Train                | Train                | Train        | Train             | Train              | Train           | Train                | Train                | Train        | Train             | Val        | Val                | Val             | Val                  | Val                  | Val          | Val               | Val                | Val             | Val                  | Val                  | Val          | Val               | Test      | Test               | Test            | Test                 | Test                 | Test         | Test              | Test               | Test            | Test                 | Test                 | Test         | Test              |
| ----------------------------------- | ---------- | --------------- | -------- | -------- | ----------- | ---------- | --------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | --------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- |
| Experiment Idx                      | Model info | MIL Info        | size     | lr       | Total Epoch | Best Epoch | Acc       | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc       | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score |
| ViT_384_401_PT_lf05_b4_p32_ROSE_MIL | MIL ViT    | CLS+CLS_MIL+MIL | 384, P32 | 401_lf05 | 50          | 49         | 99.410609 | 99.4411006         | 99.655321       | 99.655321            | 98.9533011           | 99.3532741   | 99.5480955        | 99.3532741         | 98.9533011      | 98.9533011           | 99.655321            | 99.4411006   | 99.1528842        | 93.5166994 | 95.1661631         | 94.8795181      | 94.8795181           | 90.960452            | 90.4494382   | 95.0226244        | 90.4494382         | 90.960452       | 90.960452            | 94.8795181           | 95.1661631   | 90.7042254        | 93.996063 | 95.0524738         | 95.7703927      | 95.7703927           | 90.6779661           | 91.9770774   | 95.4100828        | 91.9770774         | 90.6779661      | 90.6779661           | 95.7703927           | 95.0524738   | 91.3229018        |



# SOTA models

|                                                |                  |          |      |          |             |            | Train      | Train              | Train           | Train                | Train                | Train        | Train             | Train              | Train           | Train                | Train                | Train        | Train             | Val        | Val                | Val             | Val                  | Val                  | Val          | Val               | Val                | Val             | Val                  | Val                  | Val          | Val               | Test       | Test               | Test            | Test                 | Test                 | Test         | Test              | Test               | Test            | Test                 | Test                 | Test         | Test              |
| ---------------------------------------------- | ---------------- | -------- | ---- | -------- | ----------- | ---------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- |
| Experiment Idx                                 | Model info       | MIL Info | size | lr       | Total Epoch | Best Epoch | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score |
| PC_efficientnet_b3_384_401_PT_lf05_b4_ROSE_CLS | Efficientnet_b3  | CLS      | 384  | 401_lf05 | 50          | 50         | 93.1237721 | 93.6134454         | 95.9931064      | 95.9931064           | 87.7616747           | 92.1386306   | 94.7883429        | 92.1386306         | 87.7616747      | 87.7616747           | 95.9931064           | 93.6134454   | 89.8969072        | 90.5697446 | 94.0993789         | 91.2650602      | 91.2650602           | 89.2655367           | 84.4919786   | 92.6605505        | 84.4919786         | 89.2655367      | 89.2655367           | 91.2650602           | 94.0993789   | 86.8131868        | 89.5669291 | 91.9939577         | 91.9939577      | 91.9939577           | 85.0282486           | 85.0282486   | 91.9939577        | 85.0282486         | 85.0282486      | 85.0282486           | 91.9939577           | 91.9939577   | 85.0282486        |
| PC_Hybrid2_384_401_PT_lf05_b4_ROSE_CLS         | MSHT             | CLS      | 384  | 401_lf05 | 50          | 31         | 93.348302  | 94.2275042         | 95.6484274      | 95.6484274           | 89.0499195           | 91.6321458   | 94.9326491        | 91.6321458         | 89.0499195      | 89.0499195           | 95.6484274           | 94.2275042   | 90.3225806        | 91.7485265 | 92.8994083         | 94.5783133      | 94.5783133           | 86.440678            | 89.4736842   | 93.7313433        | 89.4736842         | 86.440678       | 86.440678            | 94.5783133           | 92.8994083   | 87.9310345        | 90.6496063 | 90.6743185         | 95.4682779      | 95.4682779           | 81.6384181           | 90.5956113   | 93.0095659        | 90.5956113         | 81.6384181      | 81.6384181           | 95.4682779           | 90.6743185   | 85.884101         |
| PC_inceptionv3_384_401_PT_lf05_b4_ROSE_CLS     | Inception v3     | CLS      | 384  | 401_lf05 | 50          | 49         | 95.5936009 | 96.1210571         | 97.1563981      | 97.1563981           | 92.6731079           | 94.5768283   | 96.6359546        | 94.5768283         | 92.6731079      | 92.6731079           | 97.1563981           | 96.1210571   | 93.6152908        | 92.3379175 | 94.2598187         | 93.9759036      | 93.9759036           | 89.2655367           | 88.7640449   | 94.1176471        | 88.7640449         | 89.2655367      | 89.2655367           | 93.9759036           | 94.2598187   | 89.0140845        | 90.7480315 | 92.9003021         | 92.9003021      | 92.9003021           | 86.7231638           | 86.7231638   | 92.9003021        | 86.7231638         | 86.7231638      | 86.7231638           | 92.9003021           | 92.9003021   | 86.7231638        |
| PC_ResNet50_384_401_PT_lf05_b4_ROSE_CLS        | ResNet50         | CLS      | 384  | 401_lf05 | 50          | 21         | 92.9834409 | 93.4901302         | 95.9069367      | 95.9069367           | 87.5201288           | 91.962775    | 94.6831136        | 91.962775          | 87.5201288      | 87.5201288           | 95.9069367           | 93.4901302   | 89.6864686        | 91.3555992 | 93.1137725         | 93.6746988      | 93.6746988           | 87.0056497           | 88           | 93.3933934        | 88                 | 87.0056497      | 87.0056497           | 93.6746988           | 93.1137725   | 87.5              | 90.7480315 | 92.5149701         | 93.3534743      | 93.3534743           | 85.8757062           | 87.3563218   | 92.9323308        | 87.3563218         | 85.8757062      | 85.8757062           | 93.3534743           | 92.5149701   | 86.6096866        |
| PC_swin_b_384_401_PT_lf05_b4_ROSE_CLS          | Swin Transformer | CLS      | 384  | 401_lf05 | 50          | 46         | 91.4959304 | 92.3593619         | 94.7867299      | 94.7867299           | 85.3462158           | 89.7544454   | 93.5573038        | 89.7544454         | 85.3462158      | 85.3462158           | 94.7867299           | 92.3593619   | 87.4948411        | 91.1591356 | 93.3534743         | 93.0722892      | 93.0722892           | 87.5706215           | 87.0786517   | 93.2126697        | 87.0786517         | 87.5706215      | 87.5706215           | 93.0722892           | 93.3534743   | 87.3239437        | 89.1732283 | 90.3508772         | 93.3534743      | 93.3534743           | 81.3559322           | 86.746988    | 91.8276374        | 86.746988          | 81.3559322      | 81.3559322           | 93.3534743           | 90.3508772   | 83.9650146        |
| PC_ViT_384_401_PT_lf05_b4_ROSE_CLS             | ViT              | CLS      | 384  | 401_lf05 | 50          | 49         | 96.9969127 | 97.5924334         | 97.8026713      | 97.8026713           | 95.4911433           | 95.8771221   | 97.6974392        | 95.8771221         | 95.4911433      | 95.4911433           | 97.8026713           | 97.5924334   | 95.6837434        | 92.9273084 | 93.7869822         | 95.4819277      | 95.4819277           | 88.1355932           | 91.2280702   | 94.6268657        | 91.2280702         | 88.1355932      | 88.1355932           | 95.4819277           | 93.7869822   | 89.6551724        | 90.6496063 | 91.8759232         | 93.9577039      | 93.9577039           | 84.4632768           | 88.20059     | 92.9051531        | 88.20059           | 84.4632768      | 84.4632768           | 93.9577039           | 91.8759232   | 86.2914863        |



# Counterpart augmentations

|                                        |            |          |      |          |             |            | Train      | Train              | Train           | Train                | Train                | Train        | Train             | Train              | Train           | Train                | Train                | Train        | Train             | Val        | Val                | Val             | Val                  | Val                  | Val          | Val               | Val                | Val             | Val                  | Val                  | Val          | Val               | Test       | Test               | Test            | Test                 | Test                 | Test         | Test              | Test               | Test            | Test                 | Test                 | Test         | Test              |
| -------------------------------------- | ---------- | -------- | ---- | -------- | ----------- | ---------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- |
| Experiment Idx                         | Model info | MIL Info | size | lr       | Total Epoch | Best Epoch | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score |
| ViT_384_401_PT_lf05_b4_ROSE_CutMix_CLS | ViT        | CLS      | 384  | 401_lf05 | 50          | 39         | 95.505618  | 96.0543063         | 97.1256971      | 97.1256971           | 92.4328723           | 94.4305902   | 96.5870307        | 94.4305902         | 92.4328723      | 92.4328723           | 97.1256971           | 96.0543063   | 93.4210526        | 93.503937  | 95.1661631         | 94.8795181      | 94.8795181           | 90.9090909           | 90.3954802   | 95.0226244        | 90.3954802         | 90.9090909      | 90.9090909           | 94.8795181           | 95.1661631   | 90.6515581        | 92.7165354 | 94.4108761         | 94.4108761      | 94.4108761           | 89.5480226           | 89.5480226   | 94.4108761        | 89.5480226         | 89.5480226      | 89.5480226           | 94.4108761           | 94.4108761   | 89.5480226        |
| ViT_384_401_PT_lf05_b4_ROSE_Cutout_CLS | ViT        | CLS      | 384  | 401_lf05 | 50          | 47         | 93.2865169 | 94.2152276         | 95.5565142      | 95.5565142           | 89.0499195           | 91.4805624   | 94.8811309        | 91.4805624         | 89.0499195      | 89.0499195           | 95.5565142           | 94.2152276   | 90.248878         | 91.7322835 | 93.1547619         | 94.2771084      | 94.2771084           | 86.9318182           | 88.9534884   | 93.7125749        | 88.9534884         | 86.9318182      | 86.9318182           | 94.2771084           | 93.1547619   | 87.9310345        | 92.3228346 | 92.9411765         | 95.4682779      | 95.4682779           | 86.440678            | 91.0714286   | 94.1877794        | 91.0714286         | 86.440678       | 86.440678            | 95.4682779           | 92.9411765   | 88.6956522        |
| ViT_384_401_PT_lf05_b4_ROSE_Mixup_CLS  | ViT        | CLS      | 384  | 401_lf05 | 50          | 50         | 93.8764045 | 94.7480786         | 95.8945549      | 95.8945549           | 90.1284109           | 92.2003284   | 95.3178694        | 92.2003284         | 90.1284109      | 90.1284109           | 95.8945549           | 94.7480786   | 91.1525974        | 93.8976378 | 94.9253731         | 95.7831325      | 95.7831325           | 90.3409091           | 91.9075145   | 95.3523238        | 91.9075145         | 90.3409091      | 90.3409091           | 95.7831325           | 94.9253731   | 91.1174785        | 92.519685  | 94.5288754         | 93.9577039      | 93.9577039           | 89.8305085           | 88.8268156   | 94.2424242        | 88.8268156         | 89.8305085      | 89.8305085           | 93.9577039           | 94.5288754   | 89.3258427        |



# Different head structure

|                                         |                          |                                     |          |          |             |            | Train      | Train              | Train           | Train                | Train                | Train        | Train             | Train              | Train           | Train                | Train                | Train        | Train             | Val        | Val                | Val             | Val                  | Val                  | Val          | Val               | Val                | Val             | Val                  | Val                  | Val          | Val               | Test       | Test               | Test            | Test                 | Test                 | Test         | Test              | Test               | Test            | Test                 | Test                 | Test         | Test              |
| --------------------------------------- | ------------------------ | ----------------------------------- | -------- | -------- | ----------- | ---------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- |
| Experiment Idx                          | Model info               | MIL Info                            | size     | lr       | Total Epoch | Best Epoch | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score |
| PC_ViT_384_401_PT_lf05_b4_ROSE_CLS      | ViT                      | CLS                                 | 384      | 401_lf05 | 50          | 49         | 96.9969127 | 97.5924334         | 97.8026713      | 97.8026713           | 95.4911433           | 95.8771221   | 97.6974392        | 95.8771221         | 95.4911433      | 95.4911433           | 97.8026713           | 97.5924334   | 95.6837434        | 92.9273084 | 93.7869822         | 95.4819277      | 95.4819277           | 88.1355932           | 91.2280702   | 94.6268657        | 91.2280702         | 88.1355932      | 88.1355932           | 95.4819277           | 93.7869822   | 89.6551724        | 90.6496063 | 91.8759232         | 93.9577039      | 93.9577039           | 84.4632768           | 88.20059     | 92.9051531        | 88.20059           | 84.4632768      | 84.4632768           | 93.9577039           | 91.8759232   | 86.2914863        |
| ViT_384_401_PT_lf05_b4_p32_NS_ROSE_MIL  | MIL ViT (no shuffle MIL) | CLS+CLS_MIL                         | 384, P32 | 401_lf05 | 50          | 39         | 97.502105  | 98.020654          | 98.1473503      | 98.1473503           | 96.2962963           | 96.5294592   | 98.0839612        | 96.5294592         | 96.2962963      | 96.2962963           | 98.1473503           | 98.020654    | 96.4127368        | 92.5343811 | 95.0920245         | 93.373494       | 93.373494            | 90.960452            | 87.9781421   | 94.224924         | 87.9781421         | 90.960452       | 90.960452            | 93.373494            | 95.0920245   | 89.4444444        | 92.1259843 | 93.1750742         | 94.8640483      | 94.8640483           | 87.0056497           | 90.0584795   | 94.011976         | 90.0584795         | 87.0056497      | 87.0056497           | 94.8640483           | 93.1750742   | 88.5057471        |
| ViT_384_401_PT_lf05_b4_p32_NCLSMIL_ROSE | MIL ViT                  | CLS+MIL, no cls step MIL regression | 384, P32 | 401_lf05 | 50          | 50         | 99.4386753 | 99.4413408         | 99.6984059      | 99.6984059           | 98.9533011           | 99.433657    | 99.5697074        | 99.433657          | 98.9533011      | 98.9533011           | 99.6984059           | 99.4413408   | 99.1928975        | 93.7131631 | 95.1807229         | 95.1807229      | 95.1807229           | 90.960452            | 90.960452    | 95.1807229        | 90.960452          | 90.960452       | 90.960452            | 95.1807229           | 95.1807229   | 90.960452         | 93.4055118 | 94.3368107         | 95.6193353      | 95.6193353           | 89.2655367           | 91.5942029   | 94.9737434        | 91.5942029         | 89.2655367      | 89.2655367           | 95.6193353           | 94.3368107   | 90.4148784        |
| ViT_384_401_PT_lf05_b4_p32_ROSE_MIL     | MIL ViT                  | CLS+CLS_MIL+MIL                     | 384, P32 | 401_lf05 | 50          | 49         | 99.410609  | 99.4411006         | 99.655321       | 99.655321            | 98.9533011           | 99.3532741   | 99.5480955        | 99.3532741         | 98.9533011      | 98.9533011           | 99.655321            | 99.4411006   | 99.1528842        | 93.5166994 | 95.1661631         | 94.8795181      | 94.8795181           | 90.960452            | 90.4494382   | 95.0226244        | 90.4494382         | 90.960452       | 90.960452            | 94.8795181           | 95.1661631   | 90.7042254        | 93.996063  | 95.0524738         | 95.7703927      | 95.7703927           | 90.6779661           | 91.9770774   | 95.4100828        | 91.9770774         | 90.6779661      | 90.6779661           | 95.7703927           | 95.0524738   | 91.3229018        |



# Different patch size

|                                      |            |                 |           |          |             |            | Train      | Train              | Train           | Train                | Train                | Train        | Train             | Train              | Train           | Train                | Train                | Train        | Train             | Val        | Val                | Val             | Val                  | Val                  | Val          | Val               | Val                | Val             | Val                  | Val                  | Val          | Val               | Test       | Test               | Test            | Test                 | Test                 | Test         | Test              | Test               | Test            | Test                 | Test                 | Test         | Test              |
| ------------------------------------ | ---------- | --------------- | --------- | -------- | ----------- | ---------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- |
| Experiment Idx                       | Model info | MIL Info        | size      | lr       | Total Epoch | Best Epoch | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score |
| ViT_384_401_PT_lf05_b4_p16_ROSE_MIL  | MIL ViT    | CLS+CLS_MIL+MIL | 384, P16  | 401_lf05 | 50          | 50         | 98.4844232 | 98.7107864         | 98.9659629      | 98.9659629           | 97.5845411           | 98.0582524   | 98.83821          | 98.0582524         | 97.5845411      | 97.5845411           | 98.9659629           | 98.7107864   | 97.8208232        | 92.1414538 | 93.9759036         | 93.9759036      | 93.9759036           | 88.700565            | 88.700565    | 93.9759036        | 88.700565          | 88.700565       | 88.700565            | 93.9759036           | 93.9759036   | 88.700565         | 93.6023622 | 93.9617084         | 96.3746224      | 96.3746224           | 88.4180791           | 92.8783383   | 95.152871         | 92.8783383         | 88.4180791      | 88.4180791           | 96.3746224           | 93.9617084   | 90.593343         |
| ViT_384_401_PT_lf05_b4_p32_ROSE_MIL  | MIL ViT    | CLS+CLS_MIL+MIL | 384, P32  | 401_lf05 | 50          | 49         | 99.410609  | 99.4411006         | 99.655321       | 99.655321            | 98.9533011           | 99.3532741   | 99.5480955        | 99.3532741         | 98.9533011      | 98.9533011           | 99.655321            | 99.4411006   | 99.1528842        | 93.5166994 | 95.1661631         | 94.8795181      | 94.8795181           | 90.960452            | 90.4494382   | 95.0226244        | 90.4494382         | 90.960452       | 90.960452            | 94.8795181           | 95.1661631   | 90.7042254        | 93.996063  | 95.0524738         | 95.7703927      | 95.7703927           | 90.6779661           | 91.9770774   | 95.4100828        | 91.9770774         | 90.6779661      | 90.6779661           | 95.7703927           | 95.0524738   | 91.3229018        |
| ViT_384_401_PT_lf05_b4_p64_ROSE_MIL  | MIL ViT    | CLS+CLS_MIL+MIL | 384, P64  | 401_lf05 | 50          | 38         | 99.3825428 | 99.6115667         | 99.4398966      | 99.4398966           | 99.2753623           | 98.9566613   | 99.5256576        | 98.9566613         | 99.2753623      | 99.2753623           | 99.4398966           | 99.6115667   | 99.1157556        | 93.7131631 | 94.9101796         | 95.4819277      | 95.4819277           | 90.3954802           | 91.4285714   | 95.1951952        | 91.4285714         | 90.3954802      | 90.3954802           | 95.4819277           | 94.9101796   | 90.9090909        | 93.1102362 | 94.1791045         | 95.3172205      | 95.3172205           | 88.9830508           | 91.0404624   | 94.7447447        | 91.0404624         | 88.9830508      | 88.9830508           | 95.3172205           | 94.1791045   | 90                |
| ViT_384_401_PT_lf05_b4_p128_ROSE_MIL | MIL ViT    | CLS+CLS_MIL+MIL | 384, P128 | 401_lf05 | 50          | 45         | 99.9158013 | 99.9568966         | 99.9138302      | 99.9138302           | 99.9194847           | 99.839099    | 99.9353588        | 99.839099          | 99.9194847      | 99.9194847           | 99.9138302           | 99.9568966   | 99.8792757        | 92.9273084 | 93.2748538         | 96.0843373      | 96.0843373           | 87.0056497           | 92.2155689   | 94.6587537        | 92.2155689         | 87.0056497      | 87.0056497           | 96.0843373           | 93.2748538   | 89.5348837        | 92.6181102 | 92.4746744         | 96.5256798      | 96.5256798           | 85.3107345           | 92.9230769   | 94.4567627        | 92.9230769         | 85.3107345      | 85.3107345           | 96.5256798           | 92.4746744   | 88.9543446        |



# Different learning rate

|                                     |            |                 |          |          |             |            | Train      | Train              | Train           | Train                | Train                | Train        | Train             | Train              | Train           | Train                | Train                | Train        | Train             | Val        | Val                | Val             | Val                  | Val                  | Val          | Val               | Val                | Val             | Val                  | Val                  | Val          | Val               | Test       | Test               | Test            | Test                 | Test                 | Test         | Test              | Test               | Test            | Test                 | Test                 | Test         | Test              |
| ----------------------------------- | ---------- | --------------- | -------- | -------- | ----------- | ---------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- |
| Experiment Idx                      | Model info | MIL Info        | size     | lr       | Total Epoch | Best Epoch | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score |
| PC_ViT_384_401_PT_lf25_b4_ROSE_CLS  | ViT        | CLS             | 384      | 401_lf25 | 50          | 45         | 94.1902891 | 95.0170358         | 96.1223611      | 96.1223611           | 90.5797101           | 92.5925926   | 95.5665025        | 92.5925926         | 90.5797101      | 90.5797101           | 96.1223611           | 95.0170358   | 91.5750916        | 91.7485265 | 92.3976608         | 95.1807229      | 95.1807229           | 85.3107345           | 90.4191617   | 93.768546         | 90.4191617         | 85.3107345      | 85.3107345           | 95.1807229           | 92.3976608   | 87.7906977        | 90.3543307 | 90.8695652         | 94.7129909      | 94.7129909           | 82.2033898           | 89.2638037   | 92.7514793        | 89.2638037         | 82.2033898      | 82.2033898           | 94.7129909           | 90.8695652   | 85.5882353        |
| ViT_384_401_PT_lf25_b4_p32_ROSE_MIL | MIL ViT    | CLS+CLS_MIL+MIL | 384, P32 | 401_lf25 | 50          | 39         | 98.4282908 | 98.6260198         | 98.9659629      | 98.9659629           | 97.4235105           | 98.0551053   | 98.7956989        | 98.0551053         | 97.4235105      | 97.4235105           | 98.9659629           | 98.6260198   | 97.7382876        | 92.9273084 | 94.8484848         | 94.2771084      | 94.2771084           | 90.3954802           | 89.3854749   | 94.5619335        | 89.3854749         | 90.3954802      | 90.3954802           | 94.2771084           | 94.8484848   | 89.8876404        | 93.011811  | 94.1704036         | 95.1661631      | 95.1661631           | 88.9830508           | 90.778098    | 94.6656649        | 90.778098          | 88.9830508      | 88.9830508           | 95.1661631           | 94.1704036   | 89.871612         |



# Different head balance

|                                        |            |                       |          |          |             |            | Train      | Train              | Train           | Train                | Train                | Train        | Train             | Train              | Train           | Train                | Train                | Train        | Train             | Val        | Val                | Val             | Val                  | Val                  | Val          | Val               | Val                | Val             | Val                  | Val                  | Val          | Val               | Test       | Test               | Test            | Test                 | Test                 | Test         | Test              | Test               | Test            | Test                 | Test                 | Test         | Test              |
| -------------------------------------- | ---------- | --------------------- | -------- | -------- | ----------- | ---------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ---------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- | ------------------ | --------------- | -------------------- | -------------------- | ------------ | ----------------- |
| Experiment Idx                         | Model info | MIL Info              | size     | lr       | Total Epoch | Best Epoch | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score | Acc        | negative_Precision | negative_Recall | negative_Sensitivity | negative_Specificity | negative_NPV | negative_F1_score | positive_Precision | positive_Recall | positive_Sensitivity | positive_Specificity | positive_NPV | positive_F1_score |
| ViT_384_401_PT_lf05_b4_p32_MIL_05_ROSE | MIL ViT    | CLS+0.5CLS_MIL+0.5MIL | 384, P32 | 401_lf05 |             | 26         | 95.9023295 | 96.4545066         | 97.2856527      | 97.2856527           | 93.3172303           | 94.8445172   | 96.8682969        | 94.8445172         | 93.3172303      | 93.3172303           | 97.2856527           | 96.4545066   | 94.0746753        | 92.5343811 | 97.1153846         | 91.2650602      | 91.2650602           | 94.9152542           | 85.2791878   | 94.0993789        | 85.2791878         | 94.9152542      | 94.9152542           | 91.2650602           | 97.1153846   | 89.8395722        | 91.7322835 | 96.1661342         | 90.9365559      | 90.9365559           | 93.220339            | 84.6153846   | 93.4782609        | 84.6153846         | 93.220339       | 93.220339            | 90.9365559           | 96.1661342   | 88.7096774        |
| ViT_384_401_PT_lf05_b4_p32_MIL_12_ROSE | MIL ViT    | CLS+1.2CLS_MIL+1.2MIL | 384, P32 | 401_lf05 |             | 33         | 98.456357  | 98.5849057         | 99.0521327      | 99.0521327           | 97.3429952           | 98.2128351   | 98.8179669        | 98.2128351         | 97.3429952      | 97.3429952           | 99.0521327           | 98.5849057   | 97.7759806        | 93.3202358 | 97.7564103         | 91.8674699      | 91.8674699           | 96.0451977           | 86.2944162   | 94.7204969        | 86.2944162         | 96.0451977      | 96.0451977           | 91.8674699           | 97.7564103   | 90.9090909        | 92.519685  | 95.2160494         | 93.2024169      | 93.2024169           | 91.2429379           | 87.7717391   | 94.1984733        | 87.7717391         | 91.2429379      | 91.2429379           | 93.2024169           | 95.2160494   | 89.4736842        |
| ViT_384_401_PT_lf05_b4_p32_MIL_15_ROSE | MIL ViT    | CLS+1.5CLS_MIL+1.5MIL | 384, P32 | 401_lf05 |             | 30         | 97.7827673 | 98.2358003         | 98.3627747      | 98.3627747           | 96.6988728           | 96.9330105   | 98.2992465        | 96.9330105         | 96.6988728      | 96.6988728           | 98.3627747           | 98.2358003   | 96.8158001        | 92.9273084 | 94.5783133         | 94.5783133      | 94.5783133           | 89.8305085           | 89.8305085   | 94.5783133        | 89.8305085         | 89.8305085      | 89.8305085           | 94.5783133           | 94.5783133   | 89.8305085        | 93.3070866 | 94.0652819         | 95.7703927      | 95.7703927           | 88.700565            | 91.8128655   | 94.9101796        | 91.8128655         | 88.700565       | 88.700565            | 95.7703927           | 94.0652819   | 90.2298851        |
| ViT_384_401_PT_lf05_b4_p32_MIL_18_ROSE | MIL ViT    | CLS+1.8CLS_MIL+1.8MIL | 384, P32 | 401_lf05 |             | 32         | 98.1476284 | 98.2869379         | 98.8797932      | 98.8797932           | 96.7793881           | 97.8827362   | 98.5824742        | 97.8827362         | 96.7793881      | 96.7793881           | 98.8797932           | 98.2869379   | 97.3279352        | 93.5166994 | 94.8948949         | 95.1807229      | 95.1807229           | 90.3954802           | 90.9090909   | 95.037594         | 90.9090909         | 90.3954802      | 90.3954802           | 95.1807229           | 94.8948949   | 90.6515581        | 93.4055118 | 94.6026987         | 95.3172205      | 95.3172205           | 89.8305085           | 91.1174785   | 94.9586155        | 91.1174785         | 89.8305085      | 89.8305085           | 95.3172205           | 94.6026987   | 90.4694168        |
| ViT_384_401_PT_lf05_b4_p32_MIL_25_ROSE | MIL ViT    | CLS+2.5CLS_MIL+2.5MIL | 384, P32 | 401_lf05 |             | 44         | 99.2422116 | 99.4396552         | 99.3968117      | 99.3968117           | 98.9533011           | 98.8736927   | 99.4182288        | 98.8736927         | 98.9533011      | 98.9533011           | 99.3968117           | 99.4396552   | 98.9134809        | 93.9096267 | 94.6587537         | 96.0843373      | 96.0843373           | 89.8305085           | 92.4418605   | 95.3662182        | 92.4418605         | 89.8305085      | 89.8305085           | 96.0843373           | 94.6587537   | 91.1174785        | 93.503937  | 94.0828402         | 96.0725076      | 96.0725076           | 88.700565            | 92.3529412   | 95.0672646        | 92.3529412         | 88.700565       | 88.700565            | 96.0725076           | 94.0828402   | 90.4899135        |
| ViT_384_401_PT_lf05_b4_p32_MIL_30_ROSE | MIL ViT    | CLS+3.0CLS_MIL+3.0MIL | 384, P32 | 401_lf05 |             | 47         | 99.0176817 | 99.1401548         | 99.3537268      | 99.3537268           | 98.389694            | 98.7873888   | 99.2468259        | 98.7873888         | 98.389694       | 98.389694            | 99.3537268           | 99.1401548   | 98.5881404        | 94.302554  | 95.4954955         | 95.7831325      | 95.7831325           | 91.5254237           | 92.0454545   | 95.6390977        | 92.0454545         | 91.5254237      | 91.5254237           | 95.7831325           | 95.4954955   | 91.7847025        | 93.6023622 | 94.7526237         | 95.4682779      | 95.4682779           | 90.1129944           | 91.4040115   | 95.1091046        | 91.4040115         | 90.1129944      | 90.1129944           | 95.4682779           | 94.7526237   | 90.7539118        |

<img width="1001" alt="CAM results" src="https://user-images.githubusercontent.com/50575108/159670793-d0970b24-70ab-46a4-b683-602cde66c8a6.png">


